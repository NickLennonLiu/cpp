### PA1a 1-4 Risk 解题报告

计95	刘玉河	2019011560

#### 数据结构与算法

##### 区间最大值：只记录下标（日期）的Queap

定义结构体riskQueue，主要包含以下两个部分：

- 数组infected：元素为每日的感染数目
- 队列maxindex：元素为最大感染数所对应日期，对应infected的下标

riskQueue支持两个操作：

- ###### enqueue_by_index(int index) : 按日期进队

    实现：从队列尾部开始向前遍历并逐个出队，直到遍历到的元素所对应的的日感染数大于当日感染数，最后在队尾插入当日日期。

- ###### getMax(int L): 获得起始日期为L，终止日期为队列末尾（当前日期）的区间的最大值

    实现：从队首开始向后遍历并逐个出队，直到队首的日期在L之后（这样实现了区间的更新），返回队首元素所对应的日感染数。

###### 算法依据

1. 由于每个日期对应的最大值区间不会向前越过前一日的区间，所以获得最大值的同时可以将区间前面的元素出队。

##### 询问操作：归并排序+二分查找

由于每次询问不改变每日的感染数参考值，故在获得了每天所对应的感染数参考值k_i之后，可以将所有的k_i进行排序；每次询问p,q时二分查找p,q在数组中的位置，即对应了相应风险段的个数。

#### 遇到的问题与解决

1. 快速排序超时

    解决思路：考虑到每日风险参考值的分布可能有一定的规律，使快速排序的时间复杂度达到较坏情况（最坏$O(n^2)$），故改用归并排序，用空间换时间的方法保证最坏情况下用时不超过$O(n\log n)$。

2. int数据类型WA

    在第一次测试后，发现int类型的范围不能满足题目对p,q,mi的要求，于是改成unsigned int，但仍然存在错误。

    与其他同学（龚然、贾启珑）讨论后，在空间允许的前提下，将大部分整型变量的类型改为long long int，确保包含测例的数据范围。

#### 复杂度分析

##### 时间复杂度

1. 获得每日对应区间的最大值

    对于每一个日期，最多进入一次队列、出一次队列，故分摊到队列的每个元素上时间复杂度是常数级的。故$T_1(n) = n\cdot O(1) = O(n)$

2. 归并排序

    $T_2(n) = O(n\log n)$

3. 询问操作（m次二分查找）

    $T_3(m,n) = 2m\cdot O(\log n) = O(m\log n)$

总体时间复杂度

$T(m,n) = O(n) + O(n\log n) + O(m\log n) = O((m+n)\log n)$

##### 空间复杂度

每日感染数infected[] ：$O(n)$

最大值队列数组maxindex[] ： $O(n)$

归并排序：$O(n)$

总体空间复杂度：$O(n)$