### PA2a 2-4-2 Kidd

计95 刘玉河 2019011560

#### 数据结构：线段树

树中每个节点代表一个区间，根节点代表整体区间[1,n]；叶节点代表单点区间[i,i]。自上而下建树。

##### 懒惰标记与向下传播

每个节点（区间）记录一个懒惰标记，代表该区间内**已操作但未向子区间传递的翻转次数**。

向下传播懒惰标记，是根据当前节点对应区间的长度，确定左右孩子的区间长度，直接更新左右孩子的翻转次数的同时，还将该节点的懒惰标记值赋值给左右孩子的懒惰标记。

##### 翻转操作

每次区间操作时，若节点区间完全被目标区间覆盖，则只更新该节点的懒惰标记，而不继续向下翻转；否则首先将当前节点的懒惰标记向下传播，再继续反转左右子区间。

询问操作与翻转操作类似，同样需要向下传播懒惰标记，在询问区间覆盖节点区间时及时返回结果。

##### 节省空间措施

注意到当区间规模n确定后，线段树中每个节点对应的区间端点也唯一确定，因此，不需要将区间端点位置存放在线段树的节点中，而是在翻转、报告函数的参数中加入当前节点对应的区间端点位置。

#### 复杂度分析

##### 时间复杂度

线段树高度：$O(\log n)$

每次查询时间：$O(\log n)$

总共时间：$O(m\log n)$

##### 空间复杂度

注意到最终建成的树至多被分为m个区间，至多2m个端点，且建成的数为完全二叉树，内部节点数不超过叶节点数$O(2m)$

故总体空间复杂度为$O(2m + 2m) = O(m)$

