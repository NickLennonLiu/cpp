# PA2b BBST Performance Analysis 报告

计95 刘玉河 2019011560

### 数据结构

#### 基类BST

作为高级平衡树的基类BST,应当实现以下基本功能：

- 高度维护updateHeight与updateHeightAbove

- 节点查找search
- 节点移除removeAt
- 3-4重构connect34
- 节点旋转rotateAt

以及相关的宏定义，如IsRChild、stature等，此处不一一列举

#### AVL

在BST的基础上，AVL树

- 新增了节点高度平衡的判断AvlBalanced
- 实现了节点的插入insert与删除remove

具体实现参考了课件与示例代码。

#### Splay

在BST的基础上，Splay树

- 新增了跨两代的旋转操作splay
- 重载了节点查找search
- 实现了节点插入insert与删除remove

具体实现参考了课件与示例代码。

### 复杂度分析

AVL与Splay树的三种操作的分摊复杂度均为$O(\log n)$,但在不同特点的操作序列下表现不尽相同。

**AVL:**

查找、插入与删除的最坏情况复杂度均为$O(\log n)$，其中删除所涉及到的旋转数量较多。

**Splay:**

当操作的节点局部性强、缓存命中率极高时能够达到更高的效率$O(\log k)$(k为局部规模)，任何连续的m次查找，都可以在$O(m\log k + n\log n)$时间内完成

若反复地顺序访问任一个子集，此时分摊成本仅为常数

### 测例生成

为了让测例生成器能够涉及绝大多数情况，并提高测例的可定制性，定义了如下的一系列函数

```cpp
// 按照ins:del:que的多项分布随机决定一个操作类型（插入/删除/查找）
char random_operation(int ins, int del, int que);
// 按照正态分布/均匀分布随机确定一个操作序列的长度(最大值为total)
int random_length(int total, bool normal);
// 生成一个有序的操作序列，区间[lo,hi]，可定制三种操作的占比
void sorted_sequence(int length, int lo, int hi, int ins, int del, int que);
// 生成一个无序的操作序列，区间[lo,hi]，可定制三种操作的占比
void random_sequence(int length, int lo, int hi, int ins, int del, int que);
// 生成一个无序的操作序列,相邻的元素之间相差不超过10，区间[lo,hi]，可定制三种操作的占比
void neighbor_sequence(int length, int lo, int hi, int ins, int del, int que);
```

所有的测例生成都根据以上函数的调用进行。通过调整参数即可获得不同情况的测例。

### 测例设计

1. 随机无序插入

2. **分段局部**无序插入
3. **分段局部有序**插入
4. 前三分之一随机插入，后三分之二随机插入/删除
5. 前三分之一随机插入，后三分之二**分段局部**随机插入/删除
6. 前三分之一随机插入，后三分之二**分段局部有序**随机插入/删除
7. 操作类型随机（1:1:1），操作区间完全随机
8. 操作类型随机（1:1:1），操作区间分段
9. 操作类型随机（1:1:1），操作区间分段，邻近操作（相邻元素不超过10）

### 性能测试

![性能测试结果（如无法查看图片请见pdf版本）](https://blog.hygephile.com/images/dsa/PA2b.jpg)

将前述9个测试点分为纯插入、插入+删除、随机操作三组，每组内调整操作区间的局域性与有序性，可以得到如上的测试结果。

#### 结果总结

1. 在同一个测试点下，AVL树的性能普遍高于Splay树
2. 操作区间的局域性与有序性对AVL的性能没有显著的影响，但对Splay树性能影响巨大

#### 原因分析

###### 为何局域性与有序性对Splay树影响巨大？

由前面的复杂度分析可知，Splay树每次访问某个节点后，都会将其旋转至根部。这样一来，Splay树在局部性强的测例下表现的性能必然更好，而有序性则保证了树的高度能够趋于平衡。

###### 为何AVL树始终比Splay树表现得好？

经过分析和与同学讨论，发现根本原因在于，要想Splay的局部操作凸显出优势，局部操作的长度不能大于AVL所能达到的树高$O(\log n)$，

后者根据测例的范围nmax = 1000000，最多也只有20左右，这个远小于测例中预设的局部区间大小（约100）。

由此结果可以知道，当总体树高$O(\log n)$较小时，即便是局部性和有序性较强的测例也无法完全凸显Splay的优势；但根据组内的结果对比，可以看到Splay对局部性和有序性的提升空间要远大于AVL。

